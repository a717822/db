<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录 | 注册</title>
    <script src="https://cdn.bootcss.com/react/15.4.2/react.min.js"></script>
    <script src="https://cdn.bootcss.com/react/15.4.2/react-dom.min.js"></script>
    <script src="https://cdn.bootcss.com/babel-standalone/6.22.1/babel.min.js"></script>

    <!-- Bootstrap -->
    <link href="../../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- Animate.css -->
    <link href="../../vendors/animate.css/animate.min.css" rel="stylesheet">

    <script src="../../vendors/jquery/dist/jquery.min.js"></script>

    <!-- Custom Theme Style -->
    <link href="../../css/custom.min.css" rel="stylesheet">
</head>
<body  class="login">
    <div id="app"></div>
</body>

<script type="text/babel">
    var Login = React.createClass({

        //登录
        login:function () {
            // 请求路径
            var url = '/user_login';
            // 请求数据
            var data = $('#login-form').serializeArray();
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: url,
                data: data,
                success: function (data) {
                    if(data.id == 0){
                        window.location.href = 'home';
                        localStorage.userInfo = JSON.stringify(data.user);
                    }else{
                        alert(data.msg);
                    }
                }
            });
        },

        //注册
        register:function(){
            // 请求路径
            var url = '/user_register';
            // 请求数据
            var data = $('#register-form').serializeArray();
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url: url,
                data: data,
                success: function (data) {
                    if(data.id == 0){
                        window.location.href = '/home/index.html';
                    }else{
                        alert(data.msg);
                    }
                }
            });
        },

        //页面渲染
        render: function() {
            return  <div>
                <a className="hiddenanchor" id="signup"></a>
                <a className="hiddenanchor" id="signin"></a>

                <div className="login_wrapper">
                    <div className="animate form login_form">
                        <section className="login_content">
                            <form id="login-form">
                                <h1>登录</h1>
                                <div>
                                    <input type="text" name="username" className="form-control" placeholder="请输入用户名" required="" />
                                </div>
                                <div>
                                    <input type="password" name="password" className="form-control" placeholder="请输入密码" required="" />
                                </div>
                                <div>
                                    <a className="btn btn-default submit" onClick={this.login} >登录</a>
                                    <a className="reset_pass" href="#">忘记密码?</a>
                                </div>

                                <div className="clearfix"></div>

                                <div className="separator">
                                    <p className="change_link">第一次来到网站?
                                        <a href="#signup" className="to_register"> 注册账户 </a>
                                    </p>

                                    <div className="clearfix"></div>
                                    <br />
                                </div>
                            </form>
                        </section>
                    </div>
                    <div id="register" className="animate form registration_form">
                        <section className="login_content">
                            <form id="register-form">
                                <h1>注册</h1>
                                <div>
                                    <input type="text" className="form-control" placeholder="请输入用户名" name="username" required="" />
                                </div>
                                <div>
                                    <input type="email" className="form-control" placeholder="请输入电子邮箱" name="email" required="" />
                                </div>
                                <div>
                                    <input type="password" className="form-control" placeholder="请输入密码" name="password" required="" />
                                </div>
                                <div>
                                    <a className="btn btn-default submit" onClick={this.register}>登录并注册</a>
                                </div>

                                <div className="clearfix"></div>

                                <div className="separator">
                                    <p className="change_link">已经注册过 ?
                                        <a href="#signin" className="to_register"> 登录 </a>
                                    </p>

                                    <div className="clearfix"></div>
                                    <br />
                                </div>
                            </form>
                        </section>
                    </div>
                </div>
            </div>;
        }
    });

    ReactDOM.render(
            <Login />, document.getElementById('app')
    );
</script>

</html>